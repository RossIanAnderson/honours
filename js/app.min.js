!function(){function t(t){var e=$("section.questionnaire"),n='<div class="questionnaire-loading"><h1>Loading Content</h1><div><i class="fa fa-spinner fa-pulse"></i></div><h3>Please Wait</h3></div>';e.html(n),e.load("core/includes/questionnaire/page"+t+".html")}$("[data-toggle]").each(function(){$(this).click(function(){var t=$(this).data("toggle");$(document).find(t).fadeToggle("0.1s")})}),$(".user-info").find('[type="submit"]').click(function(){var t=$(".user-info"),e=t.find('select[name="age"] option:selected').val(),n=t.find('select[name="sex"] option:selected').val(),a=t.find('select[name="usage"] option:selected').val(),r=t.find("p.error");return t.find(".custom-select").each(function(){$(this).removeClass("error")}),r.html(""),$.ajax({type:"POST",url:"core/includes/user-info.inc.php",data:{age:e,sex:n,usage:a},dataType:"json",success:function(e){r.text(e.message),0===e.status?t.find("select option:selected").each(function(){"0"===$(this).val()&&$(this).parent().parent().addClass("error")}):1===e.status&&location.assign("questions.php")},error:function(){r.text("An error occured. Please try again later.")}}),!1}),$(".admin-login").find('[type="submit"]').click(function(){var t=$(".admin-login"),e=t.find('input[name="u"]').val(),n=t.find('input[name="p"]').val(),a=t.find("p.error");return t.find("input").each(function(){$(this).removeClass("error")}),a.text(""),$.ajax({type:"POST",url:"core/includes/admin-login.inc.php",data:{u:e,p:n},dataType:"json",success:function(e){0===e.status?(a.text(e.message),t.find("input").each(function(){$(this).addClass("error")})):1===e.status?location.assign("admin.php"):2===e.status&&a.text(e.message)},error:function(){a.text("An error occured. Please try again later.")}}),!1}),t(1),$("footer button[data-next]").click(function(){var e=$(this).data("next"),n=e+1;t(e),3===$(this).data("next")?($("footer button").remove(),$("footer").append('<button class="pull-right" form="questionnaire-form" type="submit">Finish</button>')):$(this).data("next",n)}),$(document).delegate('input[type="range"]',"change",function(){var t=$(this).data("name"),e=$(this).val();$("#questionnaire-form").find('input[type="hidden"]').each(function(){$(this).attr("name")===t&&$(this).val(e)})}),$(".response-chart-container").ready(function(){var t=JSON.parse($(".response-chart-container #chart-data").val()),e=30,n=(e+5)*t.length,a=200,r=d3.scale.linear().domain([0,t.length]).range([0,n]),i=d3.scale.linear().domain([0,d3.max(t,function(t){return t.response})]).rangeRound([0,a]),s=d3.select("#response-chart").append("svg:svg").attr("width",n).attr("height",a);s.selectAll("rect").data(t).enter().append("svg:rect").attr("x",function(t,e){return r(e)}).attr("y",function(t){return a-i(t.response)}).attr("height",function(t){return i(t.response)}).attr("width",e).attr("fill","#2d578b"),s.selectAll("text").data(t).enter().append("svg:text").attr("x",function(t,n){return r(n)+e}).attr("y",function(t){return a-i(t.response)}).attr("dx",-e/2).attr("dy","1.2em").attr("text-anchor","middle").text(function(t){return t.response}).attr("fill","white")}),$(".pie-container").children().each(function(){var t=JSON.parse($(this).find('input[type="hidden"]').val()),e=$(this).find(".chart"),n=360,a=300,r=Math.min(n,a)/2,i=d3.scale.ordinal().range(["#304673","#32508C","#6583BF","#7A98BF","#BFC9D9"]),s=40,o=18,d=4,l=d3.selectAll(e).append("svg").attr("width",n).attr("height",a).append("g").attr("transform","translate("+n/2+","+a/2+")"),c=d3.svg.arc().innerRadius(r-s).outerRadius(r),u=d3.layout.pie().value(function(t){return t.count}).sort(null),p=d3.selectAll(".chart").append("div").attr("class","tooltip");p.append("div").attr("class","label"),p.append("div").attr("class","count"),p.append("div").attr("class","percent");var h=l.selectAll("path").data(u(t)).enter().append("path").attr("d",c).attr("fill",function(t){return i(t.data.what)});h.on("mouseover",function(t){p.select(".count").html(t.data.count),p.style("display","block")}),h.on("mouseout",function(){p.style("display","none")});var f=l.selectAll(".legend").data(i.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){var n=o+d,a=n*i.domain().length/2,r=-2*o,s=e*n-a;return"translate("+r+","+s+")"});f.append("rect").attr("width",o).attr("height",o).style("fill",i).style("stroke",i),f.append("text").attr("x",o+d).attr("y",o-d).text(function(t){return t})}),$('[data-type="age"] g.legend').each(function(){var t=$(this),e=t.find("text"),n=parseInt(e.text()),a=["err","12-17","18-24","25-34","35-44","45-54","55-64","65-74"];e.text(a[n])}),$('[data-type="sex"] g.legend').each(function(){var t=$(this),e=t.find("text"),n=parseInt(e.text()),a=["err","Female","Male","Other","Prefer to not say"];e.text(a[n])}),$('[data-type="amount"] g.legend').each(function(){var t=$(this),e=t.find("text"),n=parseInt(e.text()),a=["err","Multiple minutes in an hour","A few minutes an hour","Once an hour","Every few hours in a day","Less than every few hours in a day","Never"];e.text(a[n])})}(jQuery);